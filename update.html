<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Update Data - Exchange Position Page</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Inter', sans-serif; background: #f9fafc; margin: 0; color: #222; }
  header { text-align: center; background: #0056b3; color: white; padding: 1rem; }
  main { max-width: 800px; margin: 2rem auto; background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  h2 { color: #0056b3; }
  table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
  th, td { border: 1px solid #ccc; padding: 0.75rem; text-align: left; }
  th { background: #e9f1ff; }
  input { padding: 6px; width: 95%; }
  button { padding: 6px 12px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
  .add-btn { background: #007bff; color: white; }
  .del-btn { background: #dc3545; color: white; }
  .save-btn { background: #28a745; color: white; margin-top: 1rem; }
  .back-link { display: inline-block; background: #6c757d; color: white; padding: 8px 12px; border-radius: 5px; text-decoration: none; margin-top: 10px; }
</style>
</head>
<body>
  <header><h1>Update Data</h1></header>
  <main>
    <section>
      <h2>Officers</h2>
      <table id="officerTable">
        <thead><tr><th>Name</th><th>Position</th><th>Movement</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
      <button class="add-btn" onclick="addOfficer()">Add Officer</button>
    </section>

    <section>
      <h2>Pending Failures</h2>
      <table id="failureTable">
        <thead><tr><th>Date</th><th>Description</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
      <button class="add-btn" onclick="addFailure()">Add Failure</button>
    </section>

    <button class="save-btn" onclick="saveData()">üíæ Save (Copy JSON Below)</button><br>
    <textarea id="jsonOutput" rows="10" style="width:100%;margin-top:1rem;font-family:monospace;"></textarea>
    <a href="index.html" class="back-link">‚Üê Back to Main Page</a>
  </main>

  <script>
    let data = { officers: [], failures: [] };

    async function loadData() {
      const res = await fetch('data.json?nocache=' + Date.now());
      data = await res.json();
      renderTables();
    }

    function renderTables() {
      const oBody = document.querySelector("#officerTable tbody");
      const fBody = document.querySelector("#failureTable tbody");
      oBody.innerHTML = "";
      fBody.innerHTML = "";

      data.officers.forEach((o, i) => {
        oBody.innerHTML += `<tr>
          <td><input value="${o.name}"></td>
          <td><input value="${o.position}"></td>
          <td><input value="${o.movement || ''}"></td>
          <td><button class='del-btn' onclick='deleteOfficer(${i})'>Delete</button></td>
        </tr>`;
      });

      data.failures.forEach((f, i) => {
        fBody.innerHTML += `<tr>
          <td><input type="date" value="${f.date || ''}"></td>
          <td><input value="${f.description || ''}"></td>
          <td><button class='del-btn' onclick='deleteFailure(${i})'>Delete</button></td>
        </tr>`;
      });
    }

    function addOfficer() {
      data.officers.push({ name: "", position: "", movement: "" });
      renderTables();
    }
    function addFailure() {
      const today = new Date().toISOString().split('T')[0];
      data.failures.push({ date: today, description: "" });
      renderTables();
    }
    function deleteOfficer(i) { data.officers.splice(i, 1); renderTables(); }
    function deleteFailure(i) { data.failures.splice(i, 1); renderTables(); }

    function saveData() {
      const oRows = document.querySelectorAll("#officerTable tbody tr");
      const fRows = document.querySelectorAll("#failureTable tbody tr");
      data.officers = [];
      data.failures = [];

      oRows.forEach(r => {
        const i = r.querySelectorAll("input");
        data.officers.push({ name: i[0].value, position: i[1].value, movement: i[2].value });
      });
      fRows.forEach(r => {
        const i = r.querySelectorAll("input");
        data.failures.push({ date: i[0].value, description: i[1].value });
      });

      document.getElementById("jsonOutput").value = JSON.stringify(data, null, 2);
      alert("Copy the JSON below and replace it into data.json on GitHub to make it live.");
    }

    loadData();
  </script>
</body>
</html>
