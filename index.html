<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Exchange Position Page</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body { font-family:'Inter',sans-serif; background:#f8f9fa; color:#222; margin:0; padding:20px; }
    header { text-align:center; margin-bottom:20px; }
    h1 { margin:0; font-size:2rem; color:#333; }
    #current-date { color:#555; margin-top:5px; }
    section {
      background:#fff; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1);
      padding:20px; margin-bottom:25px;
    }
    h2 { border-bottom:2px solid #eee; padding-bottom:5px; color:#2c3e50; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { border-bottom:1px solid #ddd; padding:10px; text-align:left; }
    th { background:#f1f3f4; }
    tr:hover { background:#f9f9f9; }
    .empty-message { text-align:center; color:#888; padding:12px; }
    .btn {
      background:#007bff; color:white; border:none; border-radius:6px;
      padding:8px 14px; text-decoration:none; font-size:0.9rem;
    }
    .btn:hover { background:#0056b3; }
    .top-right { position:absolute; top:15px; right:20px; }
    footer { text-align:center; color:#777; margin-top:20px; }
  </style>
</head>
<body>
  <a class="btn top-right" href="update.html">Edit / Update Data</a>

  <header>
    <h1>Exchange Position Page</h1>
    <div id="current-date"></div>
  </header>

  <section>
    <h2>Officers & Movements</h2>
    <table id="officers-table">
      <thead><tr><th>Name</th><th>Position</th><th>Movement</th></tr></thead>
      <tbody id="officers-body"></tbody>
    </table>
    <div id="officers-empty" class="empty-message" style="display:none;">No officers found.</div>
  </section>

  <section>
    <h2>Pending Failures</h2>
    <table id="failures-table">
      <thead><tr><th>Date Created</th><th>Description of Failure/Issue</th></tr></thead>
      <tbody id="failures-body"></tbody>
    </table>
    <div id="failures-empty" class="empty-message" style="display:none;">No pending failures.</div>
  </section>

  <footer id="footer"></footer>

  <script>
    document.getElementById("current-date").textContent =
      new Date().toLocaleDateString("en-IN", {
        weekday:"long", year:"numeric", month:"long", day:"numeric"
      });

    async function loadData() {
      try {
        const res = await fetch("data.json?_=" + Date.now());
        const data = await res.json();
        populateOfficers(data.officers);
        populateFailures(data.pendingFailures);
        document.getElementById("footer").textContent =
          "Last data load: " + new Date().toLocaleString();
      } catch (e) { console.error(e); }
    }

    function populateOfficers(officers) {
      const body = document.getElementById("officers-body");
      body.innerHTML = "";
      if (!officers || officers.length === 0) {
        document.getElementById("officers-empty").style.display = "block";
        return;
      }
      officers.forEach(o => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${o.name}</td><td>${o.position}</td><td>${o.movement || "-"}</td>`;
        body.appendChild(row);
      });
    }

    function populateFailures(failures) {
      const body = document.getElementById("failures-body");
      body.innerHTML = "";
      if (!failures || failures.length === 0) {
        document.getElementById("failures-empty").style.display = "block";
        return;
      }
      failures.forEach(f => {
        const date = new Date(f.dateCreated);
        const formatted = date.toLocaleDateString("en-IN", {year:"numeric",month:"short",day:"numeric"});
        const row = document.createElement("tr");
        row.innerHTML = `<td>${formatted}</td><td>${f.description}</td>`;
        body.appendChild(row);
      });
    }

    loadData();
  </script>
</body>
</html>
