<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exchange Daily Position</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background: #f9fafb; font-family: "Inter", sans-serif; }
.card { border: none; border-radius: 1rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 2rem; }
.table th { background-color: #0d6efd; color: white; }
.table td, .table th { vertical-align: middle; }
header { text-align: center; margin: 2rem 0; }
header h1 { font-weight: 700; }
footer { text-align: center; margin-top: 2rem; color: #888; font-size: 0.9rem; }
</style>
</head>
<body>
<div class="container my-4">
  <header>
    <h1>Exchange Daily Position</h1>
    <p id="currentDate" class="text-secondary"></p>
  </header>

  <div class="card p-3">
    <h5 class="card-title text-primary mb-3">Officers Movements</h5>
    <div class="table-responsive">
      <table class="table table-bordered text-center align-middle" id="officersTable">
        <thead>
          <tr><th>Designation</th><th>Name</th><th>Movement</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="card p-3">
    <h5 class="card-title text-danger mb-3">Pending Failures / To Do Works</h5>
    <div class="table-responsive">
      <table class="table table-bordered text-center align-middle" id="failuresTable">
        <thead>
          <tr><th>Section</th><th>Date from Pending</th><th>Description</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="text-center mt-4">
    <button id="downloadExcel" class="btn btn-success btn-lg shadow">ðŸ“Š Download Day Position (Excel)</button>
  </div>

  <footer>
    <p>Hosted on <a href="https://bzaexchange.github.io/exchange-position-page/" target="_blank">GitHub Pages</a></p>
  </footer>
</div>

<!-- Excel Export and Data Load -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
const username = "bzaexchange";
const repo = "exchange-position-page";
const filePath = "data.json";
const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${filePath}`;

document.getElementById("currentDate").textContent = new Date().toLocaleDateString('en-IN', { weekday:'long', year:'numeric', month:'long', day:'numeric' });

async function loadData() {
  try {
    const res = await fetch(apiUrl);
    const json = await res.json();
    const data = JSON.parse(atob(json.content));

    fillTable('officersTable', data.officers);
    fillTable('failuresTable', data.failures);
  } catch (e) {
    console.error(e);
  }
}

function fillTable(tableId, rows) {
  const tbody = document.querySelector(`#${tableId} tbody`);
  tbody.innerHTML = "";
  rows.forEach(row => {
    const tr = document.createElement("tr");
    Object.values(row).forEach(val => {
      const td = document.createElement("td");
      td.textContent = val;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

document.getElementById("downloadExcel").addEventListener("click", () => {
  const wb = XLSX.utils.book_new();
  const officers = tableToSheet("officersTable");
  const failures = tableToSheet("failuresTable");
  XLSX.utils.book_append_sheet(wb, officers, "Officers Movements");
  XLSX.utils.book_append_sheet(wb, failures, "Pending Failures");
  const fname = `Exchange_Daily_Position_${new Date().toISOString().split('T')[0]}.xlsx`;
  XLSX.writeFile(wb, fname);
});

function tableToSheet(id) {
  const table = document.getElementById(id);
  return XLSX.utils.table_to_sheet(table);
}

loadData();
</script>
</body>
</html>
