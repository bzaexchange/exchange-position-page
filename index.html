<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exchange Daily Position</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background: #f8fafc; font-family: "Inter", sans-serif; }
header { text-align: center; margin: 2rem 0; }
.card { border: none; border-radius: 1rem; box-shadow: 0 3px 10px rgba(0,0,0,0.1); margin-bottom: 2rem; }
.card h5 { font-weight: 600; }
.table th { background: #0d6efd; color: #fff; text-align: center; }
.table td, .table th { vertical-align: middle; text-align: center; }
.btn-excel { font-size: 1.1rem; padding: 10px 20px; border-radius: 0.6rem; }
footer { text-align: center; color: #777; font-size: 0.9rem; margin-top: 2rem; }
</style>
</head>
<body>
<div class="container my-4">
  <header>
    <h1 class="fw-bold">Exchange Daily Position</h1>
    <p id="currentDate" class="text-secondary"></p>
  </header>

  <div class="card p-4">
    <h5 class="text-primary mb-3">Officers Movements</h5>
    <div class="table-responsive">
      <table class="table table-bordered" id="officersTable">
        <thead><tr><th>Designation</th><th>Name</th><th>Movement</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="card p-4">
    <h5 class="text-danger mb-3">Pending Failures / To Do Works</h5>
    <div class="table-responsive">
      <table class="table table-bordered" id="failuresTable">
        <thead><tr><th>Section</th><th>Date from Pending</th><th>Description</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="text-center">
    <button id="downloadExcel" class="btn btn-success btn-excel shadow">ðŸ“Š Download Day Position (Excel)</button>
  </div>

  <footer class="mt-4">
    <p>Â© BZA Exchange | Updated automatically from GitHub</p>
  </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
const username = "bzaexchange";
const repo = "exchange-position-page";
const filePath = "data.json";
const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${filePath}`;

document.getElementById("currentDate").textContent = new Date().toLocaleDateString('en-IN', { weekday:'long', year:'numeric', month:'long', day:'numeric' });

async function loadData() {
  try {
    const res = await fetch(apiUrl);
    const json = await res.json();
    const data = JSON.parse(atob(json.content));
    fillTable('officersTable', data.officers);
    fillTable('failuresTable', data.failures);
  } catch (e) {
    console.error("Error loading data:", e);
  }
}

function fillTable(id, rows) {
  const tbody = document.querySelector(`#${id} tbody`);
  tbody.innerHTML = "";
  rows.forEach(row => {
    const tr = document.createElement("tr");
    Object.values(row).forEach(v => {
      const td = document.createElement("td");
      td.textContent = v;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

document.getElementById("downloadExcel").addEventListener("click", () => {
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, XLSX.utils.table_to_sheet(document.getElementById("officersTable")), "Officers Movements");
  XLSX.utils.book_append_sheet(wb, XLSX.utils.table_to_sheet(document.getElementById("failuresTable")), "Pending Failures");
  const fname = `Exchange_Daily_Position_${new Date().toISOString().split('T')[0]}.xlsx`;
  XLSX.writeFile(wb, fname);
});

loadData();
</script>
</body>
</html>
