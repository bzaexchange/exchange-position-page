<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exchange Daily Position</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
  background: linear-gradient(135deg, #f9fbff, #eef3f9);
  font-family: "Inter", "Segoe UI", sans-serif;
  color: #222;
}

header {
  text-align: center;
  margin: 2.5rem 0;
}

header h1 {
  font-weight: 700;
  letter-spacing: 0.5px;
  color: #0d6efd;
}

header p {
  font-size: 1rem;
  color: #6c757d;
  margin-top: 0.4rem;
}

.card {
  border: none;
  border-radius: 1rem;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  background: #fff;
}

.card:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 25px rgba(0, 0, 0, 0.12);
}

.card h5 {
  font-weight: 700;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.card h5.text-primary::before {
  content: "üë®‚Äçüíº";
}

.card h5.text-danger::before {
  content: "‚ö†Ô∏è";
}

/* TABLE STYLING */
.table {
  border-radius: 0.5rem;
  overflow: hidden;
  background: #fff;
  table-layout: auto;
  width: 100%;
}

.table th {
  background: #0d6efd;
  color: #fff;
  text-align: center;
  font-weight: 600;
  vertical-align: middle;
  white-space: normal;
  word-wrap: break-word;
}

.table td {
  vertical-align: middle;
  text-align: center;
  background: #ffffff;
  transition: background 0.2s;
  white-space: normal;
  word-wrap: break-word;
  word-break: break-word;
  overflow-wrap: anywhere;
}

.table tbody tr:hover td {
  background: #f1f6ff;
}

.btn-excel {
  font-size: 1.1rem;
  padding: 12px 28px;
  border-radius: 0.7rem;
  background: linear-gradient(90deg, #198754, #28a745);
  border: none;
  transition: all 0.2s ease;
  color: #fff;
  font-weight: 600;
}

.btn-excel:hover {
  transform: translateY(-2px);
  background: linear-gradient(90deg, #28a745, #34c759);
}

footer {
  text-align: center;
  color: #777;
  font-size: 0.9rem;
  margin-top: 2rem;
  padding-bottom: 1rem;
}

footer p {
  margin: 0;
}

.table-responsive {
  border-radius: 0.5rem;
  overflow-x: auto;
}

/* MOBILE OPTIMIZATION */
@media (max-width: 768px) {
  header h1 { font-size: 1.6rem; }
  .btn-excel { width: 100%; }
  table { font-size: 0.85rem; }
  .table th, .table td {
    white-space: normal;
    word-break: break-word;
    overflow-wrap: anywhere;
  }
}
</style>
</head>

<body>
<div class="container my-4">
  <header>
    <h1>Exchange Daily Position</h1>
    <p id="currentDate"></p>
  </header>

  <div class="card p-4 mb-4">
    <h5 class="text-primary">Officers Movements</h5>
    <div class="table-responsive">
      <table class="table table-bordered align-middle" id="officersTable">
        <thead class="table-primary">
          <tr><th>Designation</th><th>Name</th><th>Movement</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="card p-4 mb-4">
    <h5 class="text-danger">Pending Failures / To Do Works</h5>
    <div class="table-responsive">
      <table class="table table-bordered align-middle" id="failuresTable">
        <thead class="table-danger">
          <tr><th>Section</th><th>Date from Pending</th><th>Description</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="text-center">
    <button id="downloadExcel" class="btn btn-excel shadow">üìä Download Day Position (Excel)</button>
  </div>

  <footer class="mt-4">
    <p>¬© BZA Exchange | Updated automatically from GitHub</p>
  </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
const username = "bzaexchange";
const repo = "exchange-position-page";
const filePath = "data.json";
const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${filePath}`;

document.getElementById("currentDate").textContent = new Date().toLocaleDateString('en-IN', {
  weekday:'long', year:'numeric', month:'long', day:'numeric'
});

async function loadData() {
  try {
    const res = await fetch(apiUrl);
    const json = await res.json();
    const data = JSON.parse(atob(json.content));
    fillTable('officersTable', data.officers);
    fillTable('failuresTable', data.failures);
  } catch (e) {
    console.error("Error loading data:", e);
  }
}

function fillTable(id, rows) {
  const tbody = document.querySelector(`#${id} tbody`);
  tbody.innerHTML = "";
  rows.forEach(row => {
    const tr = document.createElement("tr");
    Object.values(row).forEach(v => {
      const td = document.createElement("td");
      td.textContent = v;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

document.getElementById("downloadExcel").addEventListener("click", () => {
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, XLSX.utils.table_to_sheet(document.getElementById("officersTable")), "Officers Movements");
  XLSX.utils.book_append_sheet(wb, XLSX.utils.table_to_sheet(document.getElementById("failuresTable")), "Pending Failures");
  const fname = `Exchange_Daily_Position_${new Date().toISOString().split('T')[0]}.xlsx`;
  XLSX.writeFile(wb, fname);
});

loadData();
</script>
</body>
</html>
